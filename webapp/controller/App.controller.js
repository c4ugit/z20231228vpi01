sap.ui.define(
  [
    "./BaseController",
    "sap/ui/model/json/JSONModel",
        "sap/ui/model/Filter",
    "sap/ui/model/FilterOperator"
  ],
  function (BaseController, JSONModel, Filter,FilterOperator) {
    "use strict";

    return BaseController.extend("zmmvpi01.app.z20231228mmvpi01.controller.App", {
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* Local Constants		                                        */
      /* =========================================================== */


      APP_VIEW_MODEL: "appView",












      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* lifecycle methods                                           */
      /* =========================================================== */
      onInit: function () {
        this._oComponent = this.getOwnerComponent();

        let oViewModel = new JSONModel({
          busy: true,
          delay: 0,
          layout: "OneColumn",
          previousLayout: "",
          actionButtonsInfo: {
            midColumn: {
              fullScreen: false
            }
          }
        });
        this.setModel(oViewModel, this.getConstantBase().getConstants().APP_VIEW_MODEL);



        // apply content density mode to root view
        this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());
        this.getOwnerComponent().getModel().metadataLoaded().then(function () {
          this._getInitialData();
        }.bind(this));
      },
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* event handlers                                              */
      /* =========================================================== */






      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* begin: CORE internal methods                                */
      /* =========================================================== */









      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* begin: internal methods                                     */
      /* =========================================================== */
      _getInitialData: function () {
        this.getCallToBackendBase().callInfoUser(this);
        this.getCallToBackendBase().callStatusName(this);     
        this.getCallToBackendBase().callHelpForUser(this);     
        this.getCallToBackendBase().callInfoForUser(this);     
        // this.getCallToBackendBase().callReasonRequestList(this);     
        Promise.all([
            this._oComponent._PromiseInfoUser,
            this._oComponent._PromiseStatusName,      
            this._oComponent._PromiseHelpForUser,      
            this._oComponent._PromiseInfoForUser    
          //  this._oComponent._PromiseReasonRequestList      
        ]).then(async function (aPromise) {
       
            this.getModel(this.getConstantBase().getConstants().GLOBAL_MODEL_USER_INFO).setData(aPromise[0].results[0]);     
            this.getModel(this.getConstantBase().getConstants().GLOBAL_MODEL_STATUS_NAME).setData(aPromise[1]);     
            this.getModel(this.getConstantBase().getConstants().GLOBAL_MODEL_HELP_FOR_USER).setData(aPromise[2]);     
            this.getModel(this.getConstantBase().getConstants().GLOBAL_MODEL_INFO_FOR_USER).setData(aPromise[3].results[0]);     

            if (aPromise[3].results.length === 0) {
              let odata = {};
              odata.Bfooterdisplay = false;
              odata.Footertext = "";
              odata.Footermessagetype = "Information";
              this.getModel(this.getConstantBase().getConstants().GLOBAL_MODEL_INFO_FOR_USER).setData(odata);     
            } 
            
            this._setFilterBindSmartTableInit();

            let sUserType;
            sUserType = this.getUserType();
            if(sUserType === '05') {
                await this._callGetUserAuthorizations();
            }


          this.getOwnerComponent()._fnResolveDataLoadedInit();
        }.bind(this)).catch(async function (msg) {
          await this.messageBoxError(this.getMessagesBase().findFirstErrorMessage(this));
        }.bind(this));

      },

      _setFilterBindSmartTableInit() {
        let oFilters;
        oFilters = {};
        this.getModel(this.getConstantBase().getConstants().GLOBAL_MODEL_HELP).setProperty("/oFilterForSmartTable", oFilters);
    },



      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* begin: Fragments                                            */
      /* =========================================================== */
      /* =========================================================== */





      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* =========================================================== */
      /* begin: Call to backendu                                     */
      /* =========================================================== */
      
      _callGetUserAuthorizations: async function ()
      {
       
          let oDataGetEKGRP = {};
          try
          {
            oDataGetEKGRP = await this.getCallToBackendBase().callGetUserAuthorizations(this);

         
            let aFiltersMulti = [];
            let aFilters = [];

            for (let index = 0; index < oDataGetEKGRP.results.length; index++) {
              let Ekgrp = oDataGetEKGRP.results[index].Ekgrp;
              let oFilters = {};
              oFilters = new Filter("Ekgrp", FilterOperator.EQ, Ekgrp);
              aFiltersMulti.push(oFilters);
            } 
          aFilters.push(new Filter({
              and: false,
              filters: aFiltersMulti
          }));

          this.getModel(this.getConstantBase().getConstants().GLOBAL_MODEL_HELP).setProperty("/oFilterForSmartTable", aFilters[0]);

 

          } catch (error)
          {
              await this.messageBoxError(error);
          }
      },
    });
  }
);
